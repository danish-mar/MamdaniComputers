<%# layout('layout') removed because it's handled in app.js %>

    <div x-data="{ 
    selectedProduct: null,
    search: '',
    priceRange: 250000,
    sortOrder: 'newest',
    activeCategories: [],
    categories: ['Laptops', 'Desktops', 'Displays', 'Accessories', 'Tablets'],
    products: [
        { id: 1, name: 'MacBook Pro M3 Max', category: 'Laptops', type: 'new', price: 199900, image: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&q=80&w=1200', desc: 'The most powerful MacBook ever built.', specs: ['M3 Max Chip', '36GB Unified Memory', '1TB SSD'] },
        { id: 2, name: 'Custom Gaming Rig V2', category: 'Desktops', type: 'new', price: 148000, image: 'https://images.unsplash.com/photo-1587202372775-e229f172b9d7?auto=format&fit=crop&q=80&w=1200', desc: 'Crafted for enthusiasts.', specs: ['RTX 4080 Super', 'Intel i9-14900K', '64GB DDR5'] },
        { id: 3, name: 'iPad Pro M2', category: 'Tablets', type: 'used', price: 63900, image: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?auto=format&fit=crop&q=80&w=1200', desc: 'Unmatched tablet performance.', specs: ['Apple M2 chip', '12.9-inch Display', 'Face ID'] },
        { id: 4, name: 'Dell XPS 13 OLED', category: 'Laptops', type: 'used', price: 52000, image: 'https://images.unsplash.com/photo-1593642632823-8f785ba67e45?auto=format&fit=crop&q=80&w=1200', desc: 'Portable power with OLED.', specs: ['Intel i7', '16GB RAM', '512GB SSD'] },
        { id: 5, name: 'Apple Studio Display', category: 'Displays', type: 'new', price: 127900, image: 'https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?auto=format&fit=crop&q=80&w=1200', desc: '5K Retina perfection.', specs: ['5K Resolution', '12MP Camera', '6-Speaker System'] },
        { id: 6, name: 'ThinkPad X1 Carbon', category: 'Laptops', type: 'used', price: 71900, image: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?auto=format&fit=crop&q=80&w=1200', desc: 'Legendary business reliability.', specs: ['Intel i7 vPro', '32GB RAM', '1TB SSD'] },
        { id: 7, name: 'Mechanical Keyboard Pro', category: 'Accessories', type: 'new', price: 12000, image: 'https://images.unsplash.com/photo-1511467687858-23d96c32e4ae?auto=format&fit=crop&q=80&w=1200', desc: 'Tactile excellence.', specs: ['Brown Switches', 'RGB Backlit', 'Wireless/Wired'] },
        { id: 8, name: 'Precision Mouse X', category: 'Accessories', type: 'new', price: 7100, image: 'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?auto=format&fit=crop&q=80&w=1200', desc: 'Surgical precision.', specs: ['25K DPI Sensor', 'Ultra-lightweight', '10 Buttons'] },
        { id: 9, name: 'Mac Studio', category: 'Desktops', type: 'new', price: 159900, image: 'https://images.unsplash.com/photo-1647427060118-4911c9821b82?auto=format&fit=crop&q=80&w=1200', desc: 'Compact powerhouse for creators.', specs: ['M2 Max Chip', '32GB Memory', '512GB SSD'] }
    ],
    showMobileFilters: false,
    
    get filteredProducts() {
        let filtered = this.products.filter(p => {
            const matchesSearch = p.name.toLowerCase().includes(this.search.toLowerCase());
            const matchesPrice = p.price <= this.priceRange;
            const matchesCategory = this.activeCategories.length === 0 || this.activeCategories.includes(p.category);
            return matchesSearch && matchesPrice && matchesCategory;
        });

        if (this.sortOrder === 'price-low') {
            filtered.sort((a, b) => a.price - b.price);
        } else if (this.sortOrder === 'price-high') {
            filtered.sort((a, b) => b.price - a.price);
        } else {
            // Newest by default (descending ID for this mock)
            filtered.sort((a, b) => b.id - a.id);
        }

        return filtered;
    },

    toggleCategory(cat) {
        if (this.activeCategories.includes(cat)) {
            this.activeCategories = this.activeCategories.filter(c => c !== cat);
        } else {
            this.activeCategories.push(cat);
        }
    }
}" class="pt-24 pb-24 bg-[#fbfbfd] min-h-screen">

        <!-- Detail Modal (Same as index but consistent) -->
        <template x-teleport="body">
            <div x-show="selectedProduct" class="fixed inset-0 z-[100] flex items-center justify-center p-4"
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
                x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" x-cloak>
                <div class="absolute inset-0 bg-black/40 backdrop-blur-xl" @click="selectedProduct = null"></div>
                <div class="relative bg-white w-full max-w-4xl rounded-[2.5rem] overflow-hidden shadow-2xl flex flex-col md:flex-row"
                    x-show="selectedProduct" x-transition:enter="transition ease-out duration-500 scale-95"
                    x-transition:enter-start="scale-95 opacity-0" x-transition:enter-end="scale-100 opacity-100">
                    <div class="w-full md:w-1/2 aspect-video md:aspect-auto overflow-hidden bg-apple-gray">
                        <img :src="selectedProduct?.image" :alt="selectedProduct?.name"
                            class="w-full h-full object-cover">
                    </div>
                    <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col">
                        <div class="mb-4">
                            <span x-text="selectedProduct?.category"
                                class="text-[10px] font-bold tracking-[0.2em] uppercase text-apple-blue py-1 px-3 bg-blue-50 rounded-full"></span>
                        </div>
                        <h2 class="text-3xl font-bold text-apple-dark mb-4" x-text="selectedProduct?.name"></h2>
                        <p class="text-gray-500 mb-6 leading-relaxed" x-text="selectedProduct?.desc"></p>

                        <div class="space-y-3 mb-8">
                            <template x-for="spec in selectedProduct?.specs">
                                <div class="flex items-center text-sm text-apple-dark font-medium">
                                    <i class="fas fa-circle text-[6px] text-apple-blue mr-3"></i>
                                    <span x-text="spec"></span>
                                </div>
                            </template>
                        </div>

                        <div class="mt-auto flex items-center justify-between">
                            <span class="text-2xl font-bold text-apple-dark"
                                x-text="'₹' + selectedProduct?.price.toLocaleString('en-IN')"></span>
                            <button
                                class="px-8 py-3 bg-apple-dark text-white rounded-full font-bold hover:bg-black transition-all">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                    <button @click="selectedProduct = null"
                        class="absolute top-6 right-6 w-8 h-8 flex items-center justify-center rounded-full bg-apple-gray text-apple-dark hover:bg-gray-200 transition-colors">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
        </template>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header Section -->
            <div
                class="flex flex-col md:flex-row justify-between items-start md:items-end gap-8 mb-16 reveal-on-scroll">
                <div>
                    <h1 class="text-4xl md:text-5xl font-black text-apple-dark mb-4">Catalog.</h1>
                    <p class="text-xl text-gray-400 font-light">The complete collection of professional hardware.</p>
                </div>
                <div class="w-full md:w-auto flex items-center gap-4">
                    <div class="relative flex-1 md:w-72">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" x-model="search" placeholder="Search tech..."
                            class="w-full pl-12 pr-6 py-3 bg-white border border-gray-100 rounded-full focus:ring-2 focus:ring-apple-blue focus:border-transparent transition-all shadow-sm">
                    </div>
                    <button @click="showMobileFilters = true"
                        class="md:hidden w-12 h-12 flex items-center justify-center bg-white border border-gray-100 rounded-full text-apple-dark">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-12">
                <!-- Sidebar Filters (Desktop) -->
                <aside class="hidden lg:block w-64 space-y-10 shrink-0 reveal-on-scroll">
                    <!-- Categories -->
                    <div>
                        <h3 class="text-sm font-bold tracking-widest uppercase text-gray-400 mb-6">Categories</h3>
                        <div class="space-y-4">
                            <template x-for="cat in categories">
                                <label class="flex items-center group cursor-pointer">
                                    <div class="relative flex items-center">
                                        <input type="checkbox" @change="toggleCategory(cat)"
                                            :checked="activeCategories.includes(cat)" class="peer sr-only">
                                        <div
                                            class="w-5 h-5 border-2 border-gray-200 rounded-md group-hover:border-apple-blue transition-colors peer-checked:bg-apple-blue peer-checked:border-apple-blue flex items-center justify-center">
                                            <i
                                                class="fas fa-check text-[10px] text-white opacity-0 peer-checked:opacity-100"></i>
                                        </div>
                                        <span
                                            class="ml-3 text-gray-600 group-hover:text-apple-dark transition-colors font-medium"
                                            x-text="cat"></span>
                                    </div>
                                </label>
                            </template>
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div>
                        <h3 class="text-sm font-bold tracking-widest uppercase text-gray-400 mb-6">Max Price</h3>
                        <div class="space-y-4">
                            <input type="range" x-model="priceRange" min="0" max="250000" step="1000"
                                class="w-full accent-apple-blue">
                            <div class="flex justify-between text-sm font-bold text-apple-dark">
                                <span>₹0</span>
                                <span x-text="'₹' + parseInt(priceRange).toLocaleString('en-IN')"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Sorting -->
                    <div>
                        <h3 class="text-sm font-bold tracking-widest uppercase text-gray-400 mb-6">Sort By</h3>
                        <select x-model="sortOrder"
                            class="w-full bg-white border border-gray-100 rounded-xl px-4 py-3 text-apple-dark font-medium focus:ring-2 focus:ring-apple-blue transition-all outline-none">
                            <option value="newest">Newest Arrivals</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                        </select>
                    </div>
                </aside>

                <!-- Product Grid -->
                <main class="flex-1">
                    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8">
                        <template x-for="product in filteredProducts" :key="product.id">
                            <div class="reveal-on-scroll bento-card flex flex-col cursor-pointer group"
                                @click="selectedProduct = product">
                                <div class="aspect-square overflow-hidden bg-apple-gray relative">
                                    <img :src="product.image" :alt="product.name"
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                                    <div class="absolute top-4 right-4">
                                        <span x-text="product.type === 'new' ? 'New' : 'Used'"
                                            :class="product.type === 'new' ? 'bg-apple-blue text-white' : 'bg-apple-dark text-white'"
                                            class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest"></span>
                                    </div>
                                </div>
                                <div class="p-6 flex flex-col flex-1">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest"
                                            x-text="product.category"></span>
                                        <span class="text-lg font-bold text-apple-dark"
                                            x-text="'₹' + product.price.toLocaleString('en-IN')"></span>
                                    </div>
                                    <h3 class="text-xl font-bold text-apple-dark mb-2" x-text="product.name"></h3>
                                    <p class="text-sm text-gray-500 line-clamp-2 mb-6" x-text="product.desc"></p>
                                    <div class="mt-auto flex items-center text-apple-blue font-bold text-sm">
                                        Details <i
                                            class="fas fa-chevron-right ml-2 text-xs transition-transform group-hover:translate-x-1"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Empty State -->
                    <div x-show="filteredProducts.length === 0" class="py-32 text-center reveal-on-scroll">
                        <div
                            class="w-20 h-20 bg-apple-gray rounded-full flex items-center justify-center mx-auto mb-6 text-gray-300 text-3xl">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-apple-dark mb-2">No results found</h3>
                        <p class="text-gray-400">Try adjusting your filters or search terms.</p>
                        <button @click="search = ''; activeCategories = []; priceRange = 3000"
                            class="mt-8 text-apple-blue font-bold hover:underline">Clear all filters</button>
                    </div>
                </main>
            </div>
        </div>

        <!-- Mobile Filters Overlay -->
        <div x-show="showMobileFilters" class="fixed inset-0 z-[100] lg:hidden"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-cloak>
            <div class="absolute inset-0 bg-black/20 backdrop-blur-sm" @click="showMobileFilters = false"></div>
            <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-[2.5rem] p-8 max-h-[90vh] overflow-y-auto"
                x-transition:enter="transition ease-out duration-300 translate-y-full"
                x-transition:enter-start="translate-y-full" x-transition:enter-end="translate-y-0">
                <div class="flex justify-between items-center mb-10">
                    <h2 class="text-2xl font-bold text-apple-dark">Filters</h2>
                    <button @click="showMobileFilters = false"
                        class="w-10 h-10 flex items-center justify-center bg-apple-gray rounded-full text-apple-dark">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="space-y-12 pb-10">
                    <!-- Mobile Categories -->
                    <div>
                        <h3 class="text-xs font-bold tracking-widest uppercase text-gray-400 mb-6">Categories</h3>
                        <div class="flex flex-wrap gap-3">
                            <template x-for="cat in categories">
                                <button @click="toggleCategory(cat)"
                                    :class="activeCategories.includes(cat) ? 'bg-apple-blue text-white' : 'bg-apple-gray text-gray-600'"
                                    class="px-6 py-3 rounded-full text-sm font-bold transition-all"
                                    x-text="cat"></button>
                            </template>
                        </div>
                    </div>

                    <!-- Mobile Price -->
                    <div>
                        <h3 class="text-xs font-bold tracking-widest uppercase text-gray-400 mb-6">Max Price</h3>
                        <input type="range" x-model="priceRange" min="0" max="250000" step="1000"
                            class="w-full accent-apple-blue h-2 rounded-lg appearance-none bg-gray-200">
                        <div class="flex justify-between text-lg font-bold text-apple-dark mt-4">
                            <span>₹0</span>
                            <span x-text="'₹' + parseInt(priceRange).toLocaleString('en-IN')"></span>
                        </div>
                    </div>

                    <!-- Mobile Sort -->
                    <div>
                        <h3 class="text-xs font-bold tracking-widest uppercase text-gray-400 mb-6">Sort By</h3>
                        <div class="grid grid-cols-1 gap-3">
                            <button @click="sortOrder = 'newest'"
                                :class="sortOrder === 'newest' ? 'border-apple-blue text-apple-blue bg-blue-50' : 'border-gray-100 text-gray-600'"
                                class="px-6 py-4 rounded-2xl border-2 text-left font-bold transition-all text-sm">Newest
                                Arrivals</button>
                            <button @click="sortOrder = 'price-low'"
                                :class="sortOrder === 'price-low' ? 'border-apple-blue text-apple-blue bg-blue-50' : 'border-gray-100 text-gray-600'"
                                class="px-6 py-4 rounded-2xl border-2 text-left font-bold transition-all text-sm">Price:
                                Low to High</button>
                            <button @click="sortOrder = 'price-high'"
                                :class="sortOrder === 'price-high' ? 'border-apple-blue text-apple-blue bg-blue-50' : 'border-gray-100 text-gray-600'"
                                class="px-6 py-4 rounded-2xl border-2 text-left font-bold transition-all text-sm">Price:
                                High to Low</button>
                        </div>
                    </div>

                    <div class="pt-6">
                        <button @click="showMobileFilters = false"
                            class="w-full py-5 bg-apple-dark text-white rounded-2xl font-bold text-lg">Apply
                            Filters</button>
                        <button
                            @click="search = ''; activeCategories = []; priceRange = 3000; showMobileFilters = false"
                            class="w-full mt-4 py-3 text-gray-400 font-bold text-sm">Reset All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>