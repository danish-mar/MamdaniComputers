<div x-data="{ 
    product: null,
    loading: true,
    activeImage: 0,
    productId: '<%= productId %>',
    
    async init() {
        try {
            const allProducts = await ProductsFetcher.getProducts();
            this.product = allProducts.find(p => p.id === this.productId);
            if (!this.product) {
                // If not found in primary list, it might be a direct fetch if API supports it
                // For now, if not found, we show an error
                console.error('Product not found in local cache');
            }
        } catch (error) {
            console.error('Error loading product detail:', error);
        } finally {
            this.loading = false;
        }
    }
}" class="pt-32 pb-24 min-h-screen dark:bg-black transition-colors duration-500">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Loading State -->
        <div x-show="loading" class="py-32 text-center">
            <div class="flex justify-center items-center space-x-3 mb-6">
                <div class="w-3 h-3 bg-apple-blue rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                <div class="w-3 h-3 bg-apple-blue rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                <div class="w-3 h-3 bg-apple-blue rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
            </div>
            <p class="text-gray-400 text-lg font-medium">Loading product details...</p>
        </div>

        <!-- Error State -->
        <div x-show="!loading && !product" class="py-32 text-center">
            <h2 class="text-3xl font-bold text-apple-dark dark:text-white mb-4">Product Not Found</h2>
            <p class="text-gray-500 mb-8">The product you are looking for might have been sold or removed.</p>
            <a href="/products" class="px-8 py-4 bg-apple-blue text-white rounded-full font-bold hover:scale-105 transition-all inline-block">
                Back to Catalog
            </a>
        </div>

        <!-- Product Content -->
        <div x-show="!loading && product" class="grid grid-cols-1 lg:grid-cols-2 gap-16">
            <!-- Left: Sidebar Gallery -->
            <div class="space-y-6">
                <div class="aspect-square bg-white dark:bg-[#1c1c1e] rounded-[3rem] overflow-hidden shadow-2xl">
                    <img :src="product?.images?.[activeImage] || 'https://via.placeholder.com/800x800?text=No+Image'" 
                         :alt="product?.name"
                         class="w-full h-full object-cover transition-opacity duration-500">
                </div>
                
                <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide">
                    <template x-for="(img, index) in product?.images" :key="index">
                        <button @click="activeImage = index" 
                                :class="activeImage === index ? 'ring-2 ring-apple-blue' : 'opacity-60 hover:opacity-100'"
                                class="w-24 h-24 shrink-0 bg-white dark:bg-[#1c1c1e] rounded-2xl overflow-hidden transition-all">
                            <img :src="img" class="w-full h-full object-cover">
                        </button>
                    </template>
                </div>
            </div>

            <!-- Right: Content -->
            <div class="flex flex-col">
                <nav class="mb-8 flex items-center space-x-2 text-sm font-medium text-gray-400">
                    <a href="/" class="hover:text-apple-blue">Home</a>
                    <i class="fas fa-chevron-right text-[10px]"></i>
                    <a href="/products" class="hover:text-apple-blue">Catalog</a>
                    <i class="fas fa-chevron-right text-[10px]"></i>
                    <span class="text-apple-dark dark:text-gray-200" x-text="product?.category?.name || product?.category"></span>
                </nav>

                <h1 class="text-4xl md:text-5xl font-black text-apple-dark dark:text-white mb-4" x-text="product?.name"></h1>
                
                <div class="flex items-center space-x-4 mb-8">
                    <span class="text-3xl font-bold text-apple-dark dark:text-white" 
                          x-text="'â‚¹' + product?.price.toLocaleString('en-IN')"></span>
                    <span x-show="product?.isSold" class="px-3 py-1 bg-red-500 text-white text-[10px] font-bold uppercase tracking-widest rounded-full">Sold</span>
                </div>

                <div class="prose dark:prose-invert max-w-none mb-12">
                    <p class="text-lg text-gray-500 dark:text-gray-400 leading-relaxed" x-text="product?.description || 'Professional grade hardware designed for performance.'"></p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-12">
                    <template x-for="(value, key) in product?.specifications" :key="key">
                        <div class="p-4 bg-apple-gray dark:bg-white/5 rounded-2xl border border-transparent hover:border-apple-blue/20 transition-all">
                            <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1" x-text="key"></span>
                            <span class="text-apple-dark dark:text-white font-semibold" x-text="value"></span>
                        </div>
                    </template>
                </div>

                <div class="mt-auto space-y-4">
                    <button class="w-full py-6 bg-apple-dark dark:bg-apple-blue text-white rounded-2xl font-bold text-xl hover:scale-[1.02] transition-all shadow-xl shadow-black/10 flex items-center justify-center gap-3">
                        <i class="fas fa-shopping-cart"></i>
                        Inquire Now
                    </button>
                    <p class="text-center text-xs text-gray-400">Secure checkout powered by Mamdani Systems</p>
                </div>
            </div>
        </div>
    </div>
</div>
